{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/cisco-logo-72px.svg\" width=\"75px\" height=\"75px\">\n\n**Note:** Please refer to the following before installing the solution: \r \n • Review the solution [Release Notes](https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Cisco%20ISE/ReleaseNotes.md)\r \n • There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing._\n\nThe [Cisco ISE](https://www.cisco.com/c/en_in/products/security/identity-services-engine/index.html) solution for Microsoft Sentinel enables you to ingest Cisco ISE’s NAC logs into Microsoft Sentinel, providing insight into network threats and vulnerabilities.\r\n \r\n**Underlying Microsoft Technologies used:**\n\nThis solution takes a dependency on the following technologies, and some of these dependencies either may be in [Preview](https://azure.microsoft.com/support/legal/preview-supplemental-terms/) state or might result in additional ingestion or operational costs:\r\n \r\n  a. [Agent-based log collection (Syslog) ](https://docs.microsoft.com/azure/sentinel/connect-syslog)\n\n**Data Connectors:** 1, **Parsers:** 1, **Workbooks:** 1, **Analytic Rules:** 10, **Hunting Queries:** 10, **Custom Azure Logic Apps Connectors:** 1, **Playbooks:** 3\n\n[Learn more about Microsoft Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
        "subscription": {
          "resourceProviders": [
            "Microsoft.OperationsManagement/solutions",
            "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "Microsoft.Insights/workbooks",
            "Microsoft.Logic/workflows"
          ]
        },
        "location": {
          "metadata": {
            "hidden": "Hiding location, we get it from the log analytics workspace"
          },
          "visible": false
        },
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "basics": [
      {
        "name": "getLAWorkspace",
        "type": "Microsoft.Solutions.ArmApiControl",
        "toolTip": "This filters by workspaces that exist in the Resource Group selected",
        "condition": "[greater(length(resourceGroup().name),0)]",
        "request": {
          "method": "GET",
          "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
        }
      },
      {
        "name": "workspace",
        "type": "Microsoft.Common.DropDown",
        "label": "Workspace",
        "placeholder": "Select a workspace",
        "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
        "constraints": {
          "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(toLower(filter.id), toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
          "required": true
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "dataconnectors",
        "label": "Data Connectors",
        "bladeTitle": "Data Connectors",
        "elements": [
          {
            "name": "dataconnectors1-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Azure Activity- Azure Activity Log is a subscription log that provides insight into subscription-level events that occur in Azure, including events from Azure Resource Manager operational data, service health events, write operations taken on the resources in your subscription, and the status of activities performed in Azure."
            }
          },
          {
            "name": "dataconnectors2-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Azure Firewall - Connect to Azure Firewall. Azure Firewall is a managed, cloud-based network security service that protects your Azure Virtual Network resources. It's a fully stateful firewall as a service with built-in high availability and unrestricted cloud scalability."
            }
          },
          {
            "name": "dataconnectors3-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Network Security Groups - This connector lets you stream your NSG diagnostics logs into Microsoft Sentinel, allowing you to continuously monitor activity in all your instances."
            }
          },
          {
            "name": "dataconnectors4-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Microsoft Defender for Cloud- This connector allows you to stream your security alerts from Microsoft Defender for Cloud into Microsoft Sentinel, so you can view Defender data in workbooks, query it to produce alerts, and investigate and respond to incidents."
            }
          },
          {
            "name": "dataconnectors5-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Azure Storage Account- This connector lets you stream Azure Storage accounts diagnostics logs into your Microsoft Sentinel workspace, allowing you to continuously monitor activity in all your instances, and detect malicious activity in your organization."
            }
          },
          {
             "name": "dataconnectors6-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Microsoft 365- The Microsoft 365 activity log connector provides insight into ongoing user activities."
            }
          },
          {
             "name": "dataconnectors7-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Microsoft 365 Defender- This connector lets you stream Azure Storage accounts diagnostics logs into your Microsoft Sentinel workspace, allowing you to continuously monitor activity in all your instances, and detect malicious activity in your organization."
            }
          },
          {
             "name": "dataconnectors8-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Azure Active Directory- Gain insights into Azure Active Directory by connecting Audit and Sign-in logs to Microsoft Sentinel to gather insights around Azure Active Directory scenarios."
            }
          },
          {
             "name": "dataconnectors9-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Security Events via Legacy Agent- This connection enables you to view dashboards, create custom alerts, and improve investigation."
            }
          },
          {
             "name": "dataconnectors10-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Syslog- Syslog is an event logging protocol that is common to Linux. Applications will send messages that may be stored on the local machine or delivered to a Syslog collector."
            }
          },
          {
             "name": "dataconnectors11-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Azure Web Application Firewall- Connect to the Azure Web Application Firewall (WAF) for Application Gateway, Front Door, or CDN."
            }
          },
          {
             "name": "dataconnectors12-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Windows Security Events via AMA- This connection enables you to view dashboards, create custom alerts, and improve investigation."
            }
          },
          {
            "name": "dataconnectors-link2",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more about connecting data sources",
                "uri": "https://docs.microsoft.com/azure/sentinel/connect-data-sources"
              }
            }
          }
        ]
      },
      {
        "name": "workbooks",
        "label": "Workbooks",
        "subLabel": {
          "preValidation": "Configure the workbooks",
          "postValidation": "Done"
        },
        "bladeTitle": "Workbooks",
        "elements": [
          {
            "name": "workbooks-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs workbook(s) to help you gain insights into the telemetry collected in Microsoft Sentinel. After installing the solution, start using the workbook in Manage solution view."
            }
          },
          {
            "name": "workbooks-link",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-monitor-your-data"
              }
            }
          },
          {
            "name": "workbook1",
            "type": "Microsoft.Common.Section",
            "label": "Advanced KQL for Microsoft Sentinel",
            "elements": [
              {
                "name": "workbook1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Improve your KQL proficiency by using a use-case driven approach."
                   }
              }
            ]
          },
          {
            "name": "workbook2",
            "type": "Microsoft.Common.Section",
            "label": "Azure AD Audit logs",
            "elements": [
              {
                "name": "workbook2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Gain insights into Azure Active Directory by connecting Microsoft Sentinel and using the audit logs to gather insights around Azure AD scenarios."
                   }
              }
            ]
          },
          {
            "name": "workbook3",
            "type": "Microsoft.Common.Section",
            "label": "Azure AD Sign-in logs",
            "elements": [
              {
                "name": "workbook3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Gain insights into Azure Active Directory by connecting Microsoft Sentinel and using the sign-in logs to gather insights around Azure AD scenarios."
                   }
              }
            ]
          },
          {
            "name": "workbook4",
            "type": "Microsoft.Common.Section",
            "label": "Azure Activity",
            "elements": [
              {
                "name": "workbook4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Gain extensive insight into your organization's Azure Activity by analyzing, and correlating all user operations and events."
                   }
              }
            ]
          },
          {
            "name": "workbook5",
            "type": "Microsoft.Common.Section",
            "label": "Intro to KQL",
            "elements": [
              {
                "name": "workbook5-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Learn and practice the Kusto Query Language."
                   }
              }
            ]
          },
          {
            "name": "workbook6",
            "type": "Microsoft.Common.Section",
            "label": "NISTSP80053workbook",
            "elements": [
              {
                "name": "workbook6-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This Solution enables Compliance Teams, Architects, SecOps Analysts, and Consultants to gain situational awareness for cloud workload security posture."
                   }
              }
            ]
          },
          {
            "name": "workbook7",
            "type": "Microsoft.Common.Section",
            "label": "SOC Process Framework",
            "elements": [
              {
                "name": "workbook7-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This workbook contains years of SOC Best Practices and is intended to help SOCs mature and leverage industry standards in Operationalizing their SOC in using Microsoft Sentinel."
                }
              }
            ]
          }
        ]
      },
      {
        "name": "analytics",
        "label": "Analytics",
        "subLabel": {
          "preValidation": "Configure the analytics",
          "postValidation": "Done"
        },
        "bladeTitle": "Analytics",
        "elements": [
          {
            "name": "analytics-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs the following analytic rule templates. After installing the solution, create and enable analytic rules in Manage solution view."
            }
          },
          {
            "name": "analytics-link",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-detect-threats-custom?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          },
          {
            "name": "analytic1",
            "type": "Microsoft.Common.Section",
            "label": "CiscoISE - ISE administrator password has been reset",
            "elements": [
              {
                "name": "analytic1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects when the ISE administrator password has been reset."
                }
              }
            ]
          },
          {
            "name": "analytic2",
            "type": "Microsoft.Common.Section",
            "label": "CiscoISE - Attempt to delete local store logs",
            "elements": [
              {
                "name": "analytic2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects when attempt to delete local store logs failed."
                }
              }
            ]
          },
          {
            "name": "analytic3",
            "type": "Microsoft.Common.Section",
            "label": "CiscoISE - Backup failed",
            "elements": [
              {
                "name": "analytic3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects when backup activity failed."
                }
              }
            ]
          },
          {
            "name": "analytic4",
            "type": "Microsoft.Common.Section",
            "label": "CiscoISE - Certificate has expired",
            "elements": [
              {
                "name": "analytic4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects certificate expiration."
                }
              }
            ]
          },
          {
            "name": "analytic5",
            "type": "Microsoft.Common.Section",
            "label": "CiscoISE -  Command executed with the highest privileges from new IP",
            "elements": [
              {
                "name": "analytic5-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects command execution with PrivilegeLevel - 15 from new source."
                }
              }
            ]
          },
          {
            "name": "analytic6",
            "type": "Microsoft.Common.Section",
            "label": "CiscoISE - Command executed with the highest privileges by new user",
            "elements": [
              {
                "name": "analytic6-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects command execution with PrivilegeLevel - 15 by user for wich there was no such activity detected earlier."
                }
              }
            ]
          },
          {
            "name": "analytic7",
            "type": "Microsoft.Common.Section",
            "label": "CiscoISE - Device changed IP in last 24 hours",
            "elements": [
              {
                "name": "analytic7-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects when device changes IP address in last 24 hours."
                }
              }
            ]
          },
          {
            "name": "analytic8",
            "type": "Microsoft.Common.Section",
            "label": "CiscoISE - Device PostureStatus changed to non-compliant",
            "elements": [
              {
                "name": "analytic8-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects when device changes PostureStatus from \"Compliant\"."
                }
              }
            ]
          },
          {
            "name": "analytic9",
            "type": "Microsoft.Common.Section",
            "label": "CiscoISE - Log collector was suspended",
            "elements": [
              {
                "name": "analytic9-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects when log collector was suspended."
                }
              }
            ]
          },
          {
            "name": "analytic10",
            "type": "Microsoft.Common.Section",
            "label": "CiscoISE - Log files deleted",
            "elements": [
              {
                "name": "analytic10-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects log file deleting activity."
                }
              }
            ]
          }
        ]
      },
      {
        "name": "huntingqueries",
        "label": "Hunting Queries",
        "bladeTitle": "Hunting Queries",
        "elements": [
          {
            "name": "huntingqueries-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs the following hunting queries. After installing the solution, run these hunting queries to hunt for threats in Manage solution view. "
            }
          },
          {
            "name": "huntingqueries-link",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/hunting"
              }
            }
          },
          {
            "name": "huntingquery1",
            "type": "Microsoft.Common.Section",
            "label": "Anomalous AAD Account Creation",
            "elements": [
              {
                "name": "huntingquery1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "The query generates an output of all the users performing user creation where one or more features of the activity deviate from the user, their peers, or the tenant profile."
                }
              }
            ]
          },
          {
            "name": "huntingquery2",
            "type": "Microsoft.Common.Section",
            "label": "Anomalous Activity Role Assignment",
            "elements": [
              {
                "name": "huntingquery2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "The query generates an output of all users performing an "action" operation regarding an access elevation, where one or more features of the activity deviate from the user, their peers or the tenant profile."
                }
              }
            ]
          },
          {
            "name": "huntingquery3",
            "type": "Microsoft.Common.Section",
            "label": "Anomalous Geo Location Logon",
            "elements": [
              {
                "name": "huntingquery3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "The query generates an output of a successful sign-in performed by a user from a new geolocation he has never connected to before and none of their peers as well."
                }
              }
            ]
          },
          {
            "name": "huntingquery4",
            "type": "Microsoft.Common.Section",
            "label": "Anomalous Login to Devices",
            "elements": [
              {
                "name": "huntingquery4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "The query generates an output of all administrator users performing an interactive logon (4624:2) where one or more features of the activity deviate from the user, their peers, or the tenant profile."
                }
              }
            ]
          },
          {
            "name": "huntingquery5",
            "type": "Microsoft.Common.Section",
            "label": "Anomalous Password Reset",
            "elements": [
              {
                "name": "huntingquery5-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "The query generates an output of all users performing Reset User Password where one or more features of the activity deviate from the user, their peers, or the tenant profile."
                }
              }
            ]
          },
          {
            "name": "huntingquery6",
            "type": "Microsoft.Common.Section",
            "label": "Anomalous RDP Activity",
            "elements": [
              {
                "name": "huntingquery6-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Adversaries may use valid accounts to log into a computer using the Remote Desktop Protocol (RDP)."
                }
              }
            ]
          },
          {
            "name": "huntingquery7",
            "type": "Microsoft.Common.Section",
            "label": "Anomalous Sign-in Activity",
            "elements": [
              {
                "name": "huntingquery7-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "The query generates an output of successful sign-in"
                }
              }
            ]
          },
          {
            "name": "huntingquery8",
            "type": "Microsoft.Common.Section",
            "label": "Anomalous Azure Operation Hunting Model",
            "elements": [
              {
                "name": "huntingquery8-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query can be used during threat hunts to identify a range of different Azure Operation anomalies."
                }
              }
            ]
          },
          {
            "name": "huntingquery9",
            "type": "Microsoft.Common.Section",
            "label": "Azure Network Security Group NSG Administrative Operations",
            "elements": [
              {
                "name": "huntingquery9-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a set of Azure NSG administrative and operational detection queries for hunting activities."
               }
            }
            ]
          },
          {
            "name": "huntingquery10",
            "type": "Microsoft.Common.Section",
            "label": "Crash dump disabled on host",
            "elements": [
              {
                "name": "huntingquery10-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This detection looks the prevention of crash dumps being created. This can be used to limit reporting by malware, look for suspicious processes setting this registry key."
                }
              }
            ]
          },
          {
            "name": "huntingquery11",
            "type": "Microsoft.Common.Section",
            "label": "Creation of an anomalous number of resources",
            "elements": [
              {
                "name": "huntingquery11-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Looks for anomalous number of resources creation or deployment activities in azure activity log."
                }
              }
            ]
          },
          {
            "name": "huntingquery12",
            "type": "Microsoft.Common.Section",
            "label": "Multiple users email forwarded to same destination",
            "elements": [
              {
                "name": "huntingquery12-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies when multiple (more than one) users mailboxes are configured to forward to the same destination."
                }
              }
            ]
          },
          {
            "name": "huntingquery13",
            "type": "Microsoft.Common.Section",
            "label": "Potential Microsoft Security Services Tampering",
            "elements": [
              {
                "name": "huntingquery13-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query identifies potential tampering related to Microsoft security related products and services."
                }
              }
            ]
          },
          {
            "name": "huntingquery14",
            "type": "Microsoft.Common.Section",
            "label": "Webshell Detection",
            "elements": [
              {
                "name": "huntingquery14-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query can detect web shells using GET requests by searching for keywords in URL strings."
                }
              }
            ]
          },
          {
            "name": "huntingquery15",
            "type": "Microsoft.Common.Section",
            "label": "Rare Processes Run by Service Accounts",
            "elements": [
              {
                "name": "huntingquery15-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "The query collects a list of service account and then joins them with rare processes in an environment to detect anomalous behaviours."
                }
              }
            ]
          },
          {
            "name": "huntingquery16",
            "type": "Microsoft.Common.Section",
            "label": "Rare process running on a Linux host",
            "elements": [
              {
                "name": "huntingquery16-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Looks for rare processes that are running on Linux hosts."
                }
              }
            ]
          },
          {
            "name": "huntingquery17",
            "type": "Microsoft.Common.Section",
            "label": "Rare Custom Script Extension",
            "elements": [
              {
                "name": "huntingquery17-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "The query tries to identify rare custom script extensions that have been executed in your environment"
                }
              }
            ]
          },
          {
                "name": "huntingquery18",
            "type": "Microsoft.Common.Section",
            "label": "Suspicious Sign-ins to Privileged Account",
            "elements": [
              {
                "name": "huntingquery18-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query searches for any Sign-ins from non-compliant device/device registered without MFA(Multi-factor Authentication)/unknown device to privileged account using pre-built watchlist to identify accounts."
                }
              }
            ]
          },
          {
            "name": "huntingquery19",
            "type": "Microsoft.Common.Section",
            "label": "Masquerading files",
            "elements": [
              {
                "name": "huntingquery19-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "The query also filters out the legitimate locations from which svchost.exe is launched."
                }
              }
            ]
          }
        ]
      },
      {
        "name": "playbooks",
        "label": "Playbooks",
        "subLabel": {
          "preValidation": "Configure the playbooks",
          "postValidation": "Done"
        },
        "bladeTitle": "Playbooks",
        "elements": [
          {
            "name": "playbooks-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs the Playbook templates to help implement your Security Orchestration, Automation and Response (SOAR) operations. After installing the solution, these will be deployed under Playbook Templates in the Automation blade in Microsoft Sentinel. They can be configured and managed from the Manage solution view in Content Hub."
            }
          },
          {
            "name": "playbooks-link",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-respond-threats-playbook?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          }
        ]
      }
    ],
    "outputs": {
      "workspace-location": "[first(map(filter(basics('getLAWorkspace').value, (filter) => and(contains(toLower(filter.id), toLower(resourceGroup().name)),equals(filter.name,basics('workspace')))), (item) => item.location))]",
      "location": "[location()]",
      "workspace": "[basics('workspace')]"
    }
  }
}
